name: "ğŸš€ Quantum Scanner 24/7"

on:
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6 heures
  workflow_dispatch:        # Lancement manuel
  push:
    branches: [ main ]     # Se dÃ©clenche sur les pushes

jobs:
  scan-crypto:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: "ğŸ“¥ Checkout code"
      uses: actions/checkout@v4
      
    - name: "ğŸ Setup Python"
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: "ğŸ“¦ Install dependencies"
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip list | grep aiosqlite
        echo "âœ… DÃ©pendances installÃ©es"
      
    - name: "ğŸ” Load API secrets"
      run: |
        echo "Configuration des secrets..."
        echo "TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}" > .env
        echo "TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}" >> .env
        echo "COINLIST_API_KEY=${{ secrets.COINLIST_API_KEY }}" >> .env
        echo "KUCOIN_API_KEY=${{ secrets.KUCOIN_API_KEY }}" >> .env
        echo "KUCOIN_SECRET=${{ secrets.KUCOIN_SECRET }}" >> .env
        echo "KUCOIN_PASSPHRASE=${{ secrets.KUCOIN_PASSPHRASE }}" >> .env
        echo "âœ… Secrets configurÃ©s"
        
    - name: "ğŸ—ƒï¸ Setup database"
      run: |
        mkdir -p data
        python -c "
        import sqlite3
        conn = sqlite3.connect('data/quantum_scanner.db')
        conn.close()
        print('âœ… Database ready')
        "
        
    - name: "ğŸ” Run Quantum Scanner"
      run: python quantum_scanner.py --once
      
    - name: "ğŸ’¾ Save results"
      uses: actions/upload-artifact@v4
      with:
        name: scan-results
        path: data/
        retention-days: 30
        
    - name: "ğŸ“Š Generate report"
      run: |
        echo 'ğŸŒŒ QUANTUM SCAN COMPLETED'
        echo "â° $(date)"
        echo 'ğŸ“ Database saved as artifact'
        echo 'âœ… Workflow terminÃ© avec succÃ¨s'