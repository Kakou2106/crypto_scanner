name: Quantum Scanner 24/7

on:
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6 heures
  workflow_dispatch:  # D√©clenchement manuel

jobs:
  quantum-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: üõéÔ∏è Checkout code
        uses: actions/checkout@v4
      
      - name: üêç Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: üì¶ Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install
      
      - name: üîß Setup environment
        run: |
          cp .env.example .env
          # Les secrets seront inject√©s par GitHub
      
      - name: üöÄ Run Quantum Scanner
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_CHAT_REVIEW: ${{ secrets.TELEGRAM_CHAT_REVIEW }}
          ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
          BSCSCAN_API_KEY: ${{ secrets.BSCSCAN_API_KEY }}
          POLYGONSCAN_API_KEY: ${{ secrets.POLYGONSCAN_API_KEY }}
          INFURA_URL: ${{ secrets.INFURA_URL }}
          COINLIST_API_KEY: ${{ secrets.COINLIST_API_KEY }}
          GO_SCORE: ${{ vars.GO_SCORE || '70' }}
          REVIEW_SCORE: ${{ vars.REVIEW_SCORE || '40' }}
          MAX_MARKET_CAP_EUR: ${{ vars.MAX_MARKET_CAP_EUR || '210000' }}
        run: python main.py --github-actions --once
      
      - name: üìä Upload results
        uses: actions/upload-artifact@v4
        with:
          name: quantum-scan-${{ github.run_number }}-${{ github.run_attempt }}
          path: |
            results/*.json
            logs/*.log
            quantum.db
          retention-days: 30
      
      - name: üì® Notify on failure
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: 'üö® Quantum Scanner failed! Check GitHub Actions.'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}