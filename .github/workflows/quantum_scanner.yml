name: Quantum Scanner 24/7

on:
  # Run every 6 hours
  schedule:
    - cron: '0 */6 * * *'
  
  # Manual trigger
  workflow_dispatch:
  
  # On push to main
  push:
    branches:
      - main

jobs:
  scan:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout code
    - name: Checkout code
      uses: actions/checkout@v4
    
    # 2. Setup Python
    - name: Setup Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    # 3. Install dependencies (optional - our code uses only built-ins)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install python-dotenv
    
    # 4. Create .env from secrets
    - name: Create .env file
      run: |
        cat > .env << EOF
        TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}
        TELEGRAM_CHAT_REVIEW=${{ secrets.TELEGRAM_CHAT_REVIEW }}
        MAX_MARKET_CAP_EUR=210000
        EOF
    
    # 5. Run scanner
    - name: Run Quantum Scanner
      run: python main.py
    
    # 6. Upload database as artifact
    - name: Upload database
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: quantum-db-${{ github.run_number }}
        path: quantum.db
        retention-days: 30
    
    # 7. Upload logs
    - name: Upload logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: scan-logs-${{ github.run_number }}
        path: |
          *.log
        retention-days: 7
    
    # 8. Notify on failure
    - name: Notify failure
      if: failure()
      run: |
        echo "âŒ Scanner failed! Check logs above."
        exit 1