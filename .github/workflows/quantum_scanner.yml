name: Quantum Scanner 24/7

on:
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6 heures
  workflow_dispatch:  # DÃ©clenchement manuel

jobs:
  quantum-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ðŸ›Žï¸ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ðŸ“¦ Install dependencies
        run: |
          pip install -r requirements.txt
      
      - name: ðŸ”§ Create .env from GitHub Secrets
        run: |
          # CrÃ©er .env directement avec les secrets GitHub
          cat > .env << EOF
          TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_CHAT_REVIEW=${{ secrets.TELEGRAM_CHAT_ID }}
          ETHERSCAN_API_KEY=${{ secrets.ETHERSCAN_API_KEY }}
          BSCSCAN_API_KEY=${{ secrets.BSCSCAN_API_KEY }}
          POLYGONSCAN_API_KEY=${{ secrets.POLYGONSCAN_API_KEY }}
          INFURA_URL=${{ secrets.INFURA_URL }}
          COINLIST_API_KEY=${{ secrets.COINLIST_API_KEY }}
          GO_SCORE=60
          REVIEW_SCORE=30
          MAX_MARKET_CAP_EUR=210000
          SCAN_INTERVAL_HOURS=6
          MAX_PROJECTS_PER_SCAN=50
          HTTP_TIMEOUT=30
          API_DELAY=1.0
          EOF
      
      - name: ðŸš€ Run Quantum Scanner
        run: python main.py --github-actions --once
      
      - name: ðŸ“Š Upload results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: quantum-scan-${{ github.run_number }}
          path: |
            results/
            logs/
            quantum.db
          retention-days: 7